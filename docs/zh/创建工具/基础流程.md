# 创建工具

本文档介绍如何在 QuickDeck 中创建和管理工具。

## 工具概述

工具（Job）是 QuickDeck 中的核心概念，代表一个可执行的自动化任务。每个工具包含：

- **基本信息**：名称、路径、描述等
- **工作流**：定义工具的执行逻辑
- **输入参数**：工具执行时需要的参数
- **运行步骤**：具体的执行步骤

## 创建工具

### 1. 进入工具创建页面

1. 确保已选择项目（在顶部导航栏选择）
2. 点击左侧导航栏的"工具管理"
3. 点击"新建工具"按钮

### 2. 填写基本信息

在"基本信息"标签页填写：

- **工具名称**（必填）：工具的名称，例如"数据同步工具"
- **工具路径**（必填）：工具的路径，用于 URL 标识，例如 `data/sync`
  - 路径应该是唯一的
  - 建议使用层级结构，如：`team/tool-name`
  - 只能包含字母、数字、连字符和下划线
- **工具描述**（可选）：描述工具的用途和功能

### 3. 配置工作流

工作流定义了工具的执行逻辑。点击"工作流配置"标签页进行配置。

#### 3.1 基本设置

- **工作流名称**：工作流的名称（默认与工具名称相同）
- **超时时间**：工具执行的最大时间（秒），超过此时间将自动终止
- **重试次数**：工具执行失败后的重试次数
- **节点类型**：
  - **本地节点**：在服务器本地执行
  - **远程节点**：在远程节点执行（需要配置节点过滤）

#### 3.2 添加运行步骤

运行步骤定义了工具的具体执行逻辑。详细说明请参考 [运行步骤](./运行步骤/README.md)。

#### 3.3 添加输入参数

输入参数定义了工具执行时需要的参数。详细说明请参考 [创建工具-输入输出参数](./创建工具-输入输出参数.md)。

#### 3.4 配置定时执行（可选）

如果工具需要定时执行：

1. 开启"启用定时执行"开关
2. 配置 Crontab 表达式，例如：
   - `0 0 * * *`：每天 0 点执行
   - `0 */6 * * *`：每 6 小时执行一次
   - `0 9 * * 1`：每周一 9 点执行
3. 选择时区（默认：UTC）

#### 3.5 配置通知（可选）

可以配置工具执行时的通知规则：

1. 点击"添加通知"按钮
2. 选择触发时机：
   - **开始执行**：工具开始执行时
   - **执行成功**：工具执行成功时
   - **执行失败**：工具执行失败时
   - **可重试失败**：工具执行失败但可以重试时
   - **平均时长超限**：工具平均执行时长超过阈值时
3. 选择通知类型：
   - **Webhook**：发送 HTTP 请求到指定 URL
   - **钉钉 Webhook**：发送消息到钉钉群
4. 配置通知参数（根据通知类型不同而不同）

### 4. 保存工具

配置完成后，点击"保存"按钮保存工具。

## 编辑工具

1. 在工具列表中，找到要编辑的工具
2. 点击工具右侧的"编辑"按钮（或点击工具名称进入详情页后点击"编辑"）
3. 修改工具配置
4. 点击"保存"按钮

**注意**：只有工具的创建者（Owner）才能编辑工具。

## 执行工具

### 手动执行

1. 在工具列表中，找到要执行的工具
2. 点击工具右侧的"执行"按钮
3. 如果工具有输入参数，填写参数值
4. 点击"执行"按钮
5. 等待执行完成，查看执行结果

### 定时执行

如果工具配置了定时执行，系统会按照配置的 Crontab 表达式自动执行。

## 查看执行历史

1. 点击左侧导航栏的"执行历史"
2. 查看所有工具的执行记录
3. 可以按工具、状态、时间等条件筛选
4. 点击某条记录可以查看详细的执行结果和日志

## 工具权限管理

### 可见用户

可以为工具配置可见用户，只有被授权的用户才能看到和执行该工具：

1. 在工具编辑页面，找到"可见用户"设置
2. 选择要授权的用户
3. 保存工具

**注意**：
- 工具的创建者（Owner）始终可以查看和编辑工具
- 项目成员默认可以看到项目下的所有工具（除非设置了可见用户限制）

## 工具删除

1. 在工具列表中，找到要删除的工具
2. 点击工具右侧的"删除"按钮
3. 确认删除操作

**注意**：
- 只有工具的创建者（Owner）才能删除工具
- 删除工具会同时删除该工具的所有执行历史记录
- 删除操作不可恢复，请谨慎操作

## 最佳实践

### 1. 工具命名

- 使用清晰、描述性的名称
- 使用统一的命名规范，例如：`功能-操作`（如：`数据-同步`）

### 2. 工具路径

- 使用层级结构组织工具，例如：`team/tool-name`
- 保持路径简洁且有意义
- 避免使用特殊字符

### 3. 工具描述

- 详细描述工具的用途和功能
- 说明工具的使用场景
- 记录工具的依赖和前置条件

### 4. 参数设计

- 使用有意义的参数名称
- 为参数添加描述和默认值
- 合理设置必填参数

### 5. 错误处理

- 在脚本中添加适当的错误处理
- 使用清晰的错误消息
- 合理设置超时时间和重试次数

### 6. 日志记录

- 在脚本中输出有用的日志信息
- 使用结构化日志格式
- 避免输出敏感信息

## 示例：创建一个数据查询工具

让我们创建一个简单的数据查询工具作为示例：

### 1. 基本信息

- **工具名称**：用户数据查询
- **工具路径**：data/user-query
- **工具描述**：查询指定用户的详细信息

### 2. 输入参数

添加一个文本参数：
- **参数名称**：`username`
- **显示名称**：用户名
- **是否必填**：是
- **参数类型**：文本

### 3. 运行步骤

添加一个 MySQL 步骤：
- **步骤类型**：MySQL 语句
- **SQL 语句**：`SELECT * FROM users WHERE username = '{{ username }}'`
- **MySQL 凭证**：选择已配置的 MySQL 凭证

### 4. 保存并执行

保存工具后，执行工具并输入用户名，即可查询到该用户的详细信息。

## 相关文档

- [运行步骤](./运行步骤/README.md) - 了解各种运行步骤类型
- [创建工具-输入输出参数](./创建工具-输入输出参数.md) - 了解参数配置
- [常见问题](./常见问题.md) - 解决遇到的问题

---

祝您使用愉快！

