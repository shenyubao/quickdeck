# 创建工具 - 输入输出参数

本文档介绍如何在 QuickDeck 中配置工具的输入参数和输出结果。

## 输入参数概述

输入参数定义了工具执行时需要的参数。用户在执行工具时，需要提供这些参数的值。

## 参数类型

QuickDeck 支持以下参数类型：

1. **文本** - 文本字符串
2. **日期** - 日期时间
3. **数字** - 数字（整数或小数）
4. **文件** - 文件上传
5. **授权凭证** - 选择已配置的凭证
6. **JsonSchema** - 复杂的 JSON 对象

## 添加参数

### 1. 进入参数配置页面

在工具编辑页面，切换到"输入参数"标签页。

### 2. 添加参数

点击"添加参数"按钮，填写参数信息：

- **参数类型**：选择参数类型
- **参数名称**：参数的唯一标识，用于在运行步骤中引用
  - 只能包含字母、数字和下划线
  - 建议使用小写字母和下划线
  - 例如：`user_name`、`file_path`、`mysql_credential`
- **显示名称**：在界面上显示的名称（可选）
- **参数描述**：参数的说明（可选）
- **默认值**：参数的默认值（可选）
- **是否必填**：是否必须提供该参数

### 3. 保存参数

点击"确定"按钮保存参数。

## 参数类型详解

### 文本（text）

文本参数用于输入字符串。

#### 配置示例

- **参数名称**：`username`
- **显示名称**：用户名
- **参数类型**：文本
- **是否必填**：是
- **默认值**：`admin`

#### 在步骤中引用

在运行步骤中使用 `{{ 参数名 }}` 引用参数：

```
echo "Hello, {{ username }}!"
```

### 日期（date）

日期参数用于输入日期时间。

#### 配置示例

- **参数名称**：`start_date`
- **显示名称**：开始日期
- **参数类型**：日期
- **是否必填**：是
- **默认值**：`2024-01-01`

#### 在步骤中引用

```
SELECT * FROM orders WHERE created_at > '{{ start_date }}'
```

### 数字（number）

数字参数用于输入数字（整数或小数）。

#### 配置示例

- **参数名称**：`limit`
- **显示名称**：查询数量
- **参数类型**：数字
- **是否必填**：否
- **默认值**：`10`

#### 在步骤中引用

```
SELECT * FROM users LIMIT {{ limit }}
```

### 文件（file）

文件参数用于上传文件。

#### 配置示例

- **参数名称**：`data_file`
- **显示名称**：数据文件
- **参数类型**：文件
- **是否必填**：是

#### 在步骤中引用

文件上传后，参数值会是文件的路径或内容（取决于实现）：

```bash
# Bash 命令示例
cat {{ data_file }}
```

```python
# Python 脚本示例
def execute(args: dict) -> tuple:
    file_path = args.get("data_file")
    with open(file_path, 'r') as f:
        content = f.read()
    return (f"文件内容长度: {len(content)}", None)
```

### 授权凭证（credential）

授权凭证参数用于选择已配置的凭证。

#### 配置示例

- **参数名称**：`mysql_credential`
- **显示名称**：MySQL 凭证
- **参数类型**：授权凭证
- **凭证类型**：mysql（选择凭证类型）
- **是否必填**：是

#### 在步骤中引用

**在 MySQL 步骤中**：

MySQL 步骤会自动使用选中的凭证，不需要手动引用。

**在 Python 脚本中**：

```python
def execute(args: dict) -> tuple:
    # 获取凭证ID
    mysql_cred_id = args.get("mysql_credential")
    
    # 使用凭证工具类获取凭证配置
    mysql_config = credential.get_config(mysql_cred_id)
    if mysql_config:
        host = mysql_config.get("host")
        port = mysql_config.get("port")
        user = mysql_config.get("user")
        password = mysql_config.get("password")
        database = mysql_config.get("database")
        # 使用凭证信息连接数据库...
    
    return ("执行完成", None)
```

#### 支持的凭证类型

- **MySQL**：MySQL 数据库连接凭证
- **OSS**：阿里云 OSS 存储凭证
- **DeepSeek**：DeepSeek API 凭证

### JsonSchema（json_schema）

JsonSchema 参数用于输入复杂的 JSON 对象，支持自定义 JSON Schema 验证。

#### 配置示例

- **参数名称**：`json`（固定为 `json`）
- **显示名称**：JSON 数据
- **参数类型**：JsonSchema
- **Json Schema**：输入 JSON Schema 定义

#### Json Schema 示例

**示例 1：用户信息**

```json
{
  "type": "object",
  "properties": {
    "name": {
      "type": "string",
      "title": "姓名"
    },
    "age": {
      "type": "number",
      "title": "年龄"
    },
    "email": {
      "type": "string",
      "format": "email",
      "title": "邮箱"
    }
  },
  "required": ["name", "age"]
}
```

**示例 2：嵌套对象**

```json
{
  "type": "object",
  "properties": {
    "user": {
      "type": "object",
      "properties": {
        "id": {
          "type": "number",
          "title": "用户ID"
        },
        "name": {
          "type": "string",
          "title": "用户名"
        }
      },
      "required": ["id", "name"]
    },
    "options": {
      "type": "object",
      "properties": {
        "include_deleted": {
          "type": "boolean",
          "title": "包含已删除"
        }
      }
    }
  },
  "required": ["user"]
}
```

**示例 3：数组**

```json
{
  "type": "object",
  "properties": {
    "items": {
      "type": "array",
      "title": "项目列表",
      "items": {
        "type": "object",
        "properties": {
          "id": {
            "type": "number",
            "title": "ID"
          },
          "name": {
            "type": "string",
            "title": "名称"
          }
        },
        "required": ["id", "name"]
      }
    }
  },
  "required": ["items"]
}
```

#### 在步骤中引用

**在 CURL 命令中**：

```
curl -X POST https://api.example.com/data \
  -H 'Content-Type: application/json' \
  -d '{{ json | tojson }}'
```

**在 MySQL 语句中**：

```
SELECT * FROM users WHERE id = {{ json.user_id }} AND status = '{{ json.status }}'
```

**在 Python 脚本中**：

```python
def execute(args: dict) -> tuple:
    json_data = args.get("json", {})
    user_id = json_data.get("user_id")
    status = json_data.get("status")
    # ...
    return ("执行完成", None)
```

## 参数引用

### 在运行步骤中引用参数

在运行步骤中，使用 `{{ 参数名 }}` 引用参数：

```
echo "Hello, {{ username }}!"
```

### 引用 JSON Schema 参数

对于 JsonSchema 类型的参数，可以引用嵌套字段：

```
{{ json.user_id }}          # 引用 user_id 字段
{{ json.user.name }}        # 引用嵌套字段
{{ json.items[0].id }}      # 引用数组元素
```

### 参数渲染

参数值会在步骤执行前进行渲染：

- 文本参数：直接替换
- 数字参数：转换为字符串
- 日期参数：格式化为字符串
- JSON 参数：根据上下文转换为 JSON 字符串或直接替换

## 输出结果

工具执行后，会返回以下结果：

### 1. 运行结果（text）

运行结果是工具执行的主要输出，通常是文本格式。

- 对于 Bash 命令和 Shell 脚本：命令的标准输出
- 对于 Python 脚本：`execute` 函数返回的 `result_text`
- 对于 CURL 命令：HTTP 响应的内容
- 对于 MySQL 语句：查询结果（格式化为 JSON）或影响行数

### 2. 数据集（dataset）

数据集是结构化的数据，用于表格展示。

- 对于 Python 脚本：`execute` 函数返回的 `dataset`（列表）
- 对于 MySQL 查询：查询结果（自动转换为列表）

数据集格式：

```json
[
  {"id": 1, "name": "Alice", "age": 25},
  {"id": 2, "name": "Bob", "age": 30}
]
```

### 3. 执行日志（logs）

执行日志包含工具执行的详细过程信息，包括：

- 命令或脚本内容
- 执行过程中的输出
- 错误信息（如果有）
- 调试信息

## 参数验证

### 必填参数

如果参数设置为"必填"，用户执行工具时必须提供该参数的值。

### 默认值

如果参数设置了默认值，用户执行工具时可以不提供该参数，系统会使用默认值。

### JsonSchema 验证

对于 JsonSchema 类型的参数，系统会根据定义的 JSON Schema 验证用户输入的数据。

## 最佳实践

### 1. 参数命名

- 使用有意义的参数名称
- 使用小写字母和下划线
- 避免使用保留字

### 2. 参数描述

- 为每个参数添加清晰的描述
- 说明参数的用途和格式要求
- 提供使用示例（如果需要）

### 3. 默认值

- 为常用参数设置合理的默认值
- 减少用户输入的工作量
- 提高工具易用性

### 4. 参数验证

- 在脚本中验证参数值
- 提供清晰的错误提示
- 使用 JsonSchema 验证复杂数据

### 5. 敏感信息

- 不要将敏感信息作为普通参数
- 使用授权凭证参数管理敏感信息
- 避免在日志中输出敏感信息

## 示例：完整的参数配置

让我们创建一个数据查询工具，展示各种参数类型的使用：

### 参数配置

1. **用户名**（文本，必填）
   - 参数名称：`username`
   - 显示名称：用户名

2. **查询数量**（数字，可选，默认值：10）
   - 参数名称：`limit`
   - 显示名称：查询数量
   - 默认值：`10`

3. **开始日期**（日期，可选）
   - 参数名称：`start_date`
   - 显示名称：开始日期

4. **MySQL 凭证**（授权凭证，必填）
   - 参数名称：`mysql_credential`
   - 显示名称：MySQL 凭证
   - 凭证类型：mysql

5. **查询选项**（JsonSchema，可选）
   - 参数名称：`json`
   - 显示名称：查询选项
   - Json Schema：
   ```json
   {
     "type": "object",
     "properties": {
       "include_deleted": {
         "type": "boolean",
         "title": "包含已删除"
       },
       "sort_by": {
         "type": "string",
         "title": "排序字段",
         "enum": ["id", "name", "created_at"]
       }
     }
   }
   ```

### 运行步骤

使用 MySQL 步骤：

```
SQL 语句：
SELECT * FROM users 
WHERE username = '{{ username }}'
{% if start_date %}
  AND created_at > '{{ start_date }}'
{% endif %}
{% if json.include_deleted %}
  -- 包含已删除用户
{% else %}
  AND deleted_at IS NULL
{% endif %}
ORDER BY {{ json.sort_by | default('id') }}
LIMIT {{ limit }}
```

## 相关文档

- [创建工具](./创建工具.md) - 了解工具创建流程
- [运行步骤](./运行步骤/README.md) - 了解运行步骤类型
- [常见问题](./常见问题.md) - 解决遇到的问题

---

祝您使用愉快！

