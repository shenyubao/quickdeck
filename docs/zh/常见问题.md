# 常见问题

本文档收集了 QuickDeck 使用过程中的常见问题和解决方案。

## 部署相关

### Q1: 如何检查服务是否正常启动？

**A:** 使用以下命令检查服务状态：

```bash
# 查看所有服务状态
docker-compose ps

# 查看服务日志
docker-compose logs -f

# 检查特定服务
docker-compose logs -f backend
docker-compose logs -f frontend
```

### Q2: 数据库连接失败怎么办？

**A:** 检查以下几点：

1. **检查数据库容器是否运行**：
   ```bash
   docker-compose ps db
   ```

2. **检查数据库连接配置**：
   ```bash
   cat backend/.env | grep DATABASE_URL
   ```

3. **测试数据库连接**：
   ```bash
   docker exec -it quickdeck-db psql -U postgres -d quickdeck -c "SELECT 1;"
   ```

4. **查看数据库日志**：
   ```bash
   docker-compose logs db
   ```

### Q3: 前端无法访问后端 API？

**A:** 检查以下几点：

1. **检查后端服务是否运行**：
   ```bash
   docker-compose ps backend
   ```

2. **检查前端环境变量**：
   ```bash
   cat frontend/.env.local | grep NEXT_PUBLIC_URL
   ```

3. **检查 Nginx 配置**：
   ```bash
   docker-compose logs nginx
   ```

4. **直接访问后端 API**：
   访问 `http://localhost:8000/docs` 查看 API 文档是否可访问

### Q4: 如何重置数据库？

**A:** 执行以下步骤：

```bash
# 停止服务
docker-compose down

# 删除数据库卷
docker volume rm quickdeck_postgres_data

# 重新启动服务
docker-compose up -d

# 运行数据库迁移
make migrate-upgrade
```

**注意**：此操作会删除所有数据，请谨慎操作！

## 使用相关

### Q5: 如何创建管理员账号？

**A:** 管理员账号需要通过 API 创建。您可以使用以下方法：

1. **通过 API 文档创建**：
   - 访问 `http://localhost:8000/docs`
   - 找到用户创建接口
   - 设置 `is_admin=true`

2. **通过数据库直接创建**：
   ```bash
   docker exec -it quickdeck-backend python
   # 在 Python 交互环境中创建用户
   ```

### Q6: 忘记密码怎么办？

**A:** 目前系统不支持密码重置功能。如果忘记密码，需要：

1. 联系管理员重置密码
2. 或通过数据库直接修改密码哈希

### Q7: 如何删除项目？

**A:** 在项目管理页面：

1. 找到要删除的项目
2. 点击项目右侧的"删除"按钮
3. 确认删除操作

**注意**：删除项目会同时删除项目下的所有工具和凭证，此操作不可恢复！

### Q8: 工具执行失败怎么办？

**A:** 按以下步骤排查：

1. **查看执行日志**：
   - 在"执行历史"页面找到失败的执行记录
   - 点击记录查看详细的执行日志

2. **检查输入参数**：
   - 确认所有必填参数都已提供
   - 检查参数值格式是否正确

3. **检查运行步骤配置**：
   - 确认步骤类型和内容配置正确
   - 检查参数引用是否正确

4. **检查凭证配置**：
   - 如果使用了凭证，确认凭证配置正确
   - 测试凭证是否有效

5. **检查超时设置**：
   - 如果工具执行时间较长，增加超时时间

### Q9: Python 脚本执行失败？

**A:** 检查以下几点：

1. **函数签名**：
   - 确保实现了 `execute` 函数
   - 函数签名必须是：`def execute(args: dict) -> tuple:`

2. **返回值**：
   - 返回值必须是元组：`(result_text, dataset)`
   - `result_text` 必须是字符串
   - `dataset` 必须是列表或 `None`

3. **语法错误**：
   - 检查 Python 代码语法是否正确
   - 查看执行日志中的错误信息

4. **依赖库**：
   - 确认使用的库已安装在系统中
   - 如需使用第三方库，需要先在后端环境中安装

### Q10: MySQL 步骤执行失败？

**A:** 检查以下几点：

1. **凭证配置**：
   - 确认 MySQL 凭证配置正确
   - 测试凭证是否可以连接数据库

2. **SQL 语句**：
   - 检查 SQL 语句语法是否正确
   - 确认参数引用格式正确：`{{ 参数名 }}`

3. **权限问题**：
   - 确认数据库用户有执行 SQL 的权限
   - 检查表名和字段名是否正确

4. **参数渲染**：
   - 检查参数值是否正确渲染到 SQL 语句中
   - 查看执行日志中的实际 SQL 语句

### Q11: CURL 命令执行失败？

**A:** 检查以下几点：

1. **命令格式**：
   - 检查 CURL 命令语法是否正确
   - 确认参数引用格式正确

2. **网络连接**：
   - 确认服务器可以访问目标 URL
   - 检查防火墙设置

3. **参数渲染**：
   - 检查参数值是否正确渲染
   - 查看执行日志中的实际 CURL 命令

### Q12: 如何配置定时执行？

**A:** 在工具编辑页面：

1. 切换到"工作流配置"标签页
2. 开启"启用定时执行"开关
3. 配置 Crontab 表达式，例如：
   - `0 0 * * *`：每天 0 点执行
   - `0 */6 * * *`：每 6 小时执行一次
   - `0 9 * * 1`：每周一 9 点执行
4. 选择时区（默认：UTC）

### Q13: 如何配置通知？

**A:** 在工具编辑页面：

1. 切换到"工作流配置"标签页
2. 找到"通知配置"部分
3. 点击"添加通知"按钮
4. 选择触发时机和通知类型
5. 配置通知参数（根据通知类型不同而不同）

### Q14: 如何查看工具的执行历史？

**A:** 有两种方式：

1. **在工具列表中**：
   - 点击工具右侧的"历史"按钮
   - 查看该工具的执行历史

2. **在执行历史页面**：
   - 点击左侧导航栏的"执行历史"
   - 查看所有工具的执行记录
   - 可以按工具、状态、时间等条件筛选

### Q15: 如何导出执行结果？

**A:** 目前系统不支持直接导出功能。您可以：

1. 复制执行结果文本
2. 如果结果是 JSON 格式，可以复制 JSON 数据
3. 如果结果是数据集，可以复制表格数据

## 配置相关

### Q16: 如何配置 MySQL 凭证？

**A:** 在凭证管理页面：

1. 点击左侧导航栏的"凭证管理"
2. 点击"新建凭证"按钮
3. 选择凭证类型：MySQL
4. 填写凭证信息：
   - **凭证名称**：例如"生产数据库"
   - **凭证描述**：描述凭证的用途
   - **主机地址**：数据库服务器地址
   - **端口**：数据库端口（默认：3306）
   - **用户名**：数据库用户名
   - **密码**：数据库密码
   - **数据库名**：要连接的数据库名称
5. 点击"保存"按钮

### Q17: 如何配置 OSS 凭证？

**A:** 在凭证管理页面：

1. 点击"新建凭证"按钮
2. 选择凭证类型：OSS
3. 填写凭证信息：
   - **凭证名称**：例如"生产 OSS"
   - **Endpoint**：OSS 服务端点
   - **AccessKeyId**：访问密钥 ID
   - **AccessKeySecret**：访问密钥
   - **Bucket**：存储桶名称
4. 点击"保存"按钮

### Q18: 如何修改系统配置？

**A:** 在系统配置页面（需要管理员权限）：

1. 点击左侧导航栏的"系统配置"
2. 查看或修改系统配置项
3. 点击"保存"按钮

## 性能相关

### Q19: 工具执行很慢怎么办？

**A:** 可以尝试以下优化：

1. **检查超时设置**：
   - 如果工具执行时间较长，增加超时时间

2. **优化脚本**：
   - 优化 Python 脚本逻辑
   - 减少不必要的数据库查询
   - 使用缓存机制

3. **检查资源使用**：
   ```bash
   docker stats
   ```

4. **增加资源限制**：
   - 在 `docker-compose.yml` 中增加容器资源限制

### Q20: 如何提高系统性能？

**A:** 建议以下优化：

1. **数据库优化**：
   - 添加适当的索引
   - 优化查询语句
   - 使用连接池

2. **缓存机制**：
   - 添加 Redis 缓存层
   - 缓存常用数据

3. **负载均衡**：
   - 使用负载均衡器分发请求
   - 横向扩展服务实例

4. **资源监控**：
   - 监控系统资源使用情况
   - 及时调整资源配置

## 其他问题

### Q21: 如何备份数据？

**A:** 执行以下命令备份数据库：

```bash
docker exec quickdeck-db pg_dump -U postgres quickdeck > backup_$(date +%Y%m%d_%H%M%S).sql
```

### Q22: 如何恢复数据？

**A:** 执行以下命令恢复数据库：

```bash
docker exec -i quickdeck-db psql -U postgres quickdeck < backup_file.sql
```

### Q23: 如何查看系统日志？

**A:** 使用以下命令：

```bash
# 查看所有服务日志
docker-compose logs -f

# 查看特定服务日志
docker-compose logs -f backend
docker-compose logs -f frontend

# 查看最近 100 行日志
docker-compose logs --tail=100

# 查看最近 1 小时的日志
docker-compose logs --since 1h
```

### Q24: 如何更新系统？

**A:** 执行以下步骤：

```bash
# 拉取最新代码
git pull

# 重新构建镜像
docker-compose build

# 重启服务
docker-compose up -d

# 运行数据库迁移（如果有）
make migrate-upgrade
```

### Q25: 遇到其他问题怎么办？

**A:** 可以尝试以下方法：

1. **查看文档**：
   - 查看相关文档页面
   - 搜索类似问题

2. **查看日志**：
   - 查看系统日志和错误信息
   - 分析错误原因

3. **提交 Issue**：
   - 在 GitHub 上提交 Issue
   - 提供详细的错误信息和复现步骤

4. **联系支持**：
   - 联系系统管理员
   - 寻求技术支持

---

如果您有其他问题，欢迎提交 Issue 或联系支持团队。

